%% init
load('/Users/david/Downloads/EBdata.mat')
data = full(data);

%% lib size norm global
libsize = sum(data,2);
data = bsxfun(@rdivide, data, libsize) * median(libsize);

%% sqrt transform
data = sqrt(data);

%% fast PHATE
tic;
Y_mmds_fast = phate_fast(data, 'k', 7, 'ndim', 2, 't', 24, 'npca', 100, 'nsvd', 100, ...
    'ncluster', 1000, 'pot_method', 'log');
toc

%% plot PHATE 2D
figure;
% subplot(1,2,1);
% scatter(Y(:,1), Y(:,2), 5, cells, 'filled');
% colormap(jet)
% set(gca,'xticklabel',[]);
% set(gca,'yticklabel',[]);
% axis tight
% xlabel 'PHATE1'
% ylabel 'PHATE2'
% title 'PHATE slow'
% subplot(1,2,2);
scatter(Y_mmds_fast(:,1), Y_mmds_fast(:,2), 5, cells, 'filled');
colormap(jet)
set(gca,'xticklabel',[]);
set(gca,'yticklabel',[]);
axis tight
xlabel 'PHATE1'
ylabel 'PHATE2'
title 'PHATE fast'
set(gcf,'paperposition',[0 0 8 6]);
print('-dtiff',[out_base 'PHATE_tSNE_runtime_with_slow.tiff']);
%close